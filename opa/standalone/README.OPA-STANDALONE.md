## Artifact attestation verification with Open Policy Agent (OPA)

### Description

Here, we have some simple REGO files which run some checks against our provenance and sbom attestations. In this README, we see how OPA as a **standalone** running server works with some custom input (policies+data+input) to validate our attestations. The present file has **nothing** to do with Continuous Deployment cases (although can fit in). These attestations refer to container images.

The container image signature verification is **NOT** done by OPA, we assume that it was done in a previous step using `cosign` or a similar tool.
We have two policies:
- One for provenance
- One for SBOM

What we do here is just check that the statement has a predicateType of `https://slsa.dev/provenance/v1` to verify that it is indeed a provenance statement. After that, we need to set our expectations for verification. We know beforehand that the attestation the we will feed into the OPA Engine is generated by our GitHub pipeline. That's why, for our case, we set some constant expectations like the `approved_repos` or `approved_runners`.

Similarly, for the SBOM, we know that we have an expressjs app, that's why the policy checks that the version of the policy is greater than 4 (no particular reason, just for demo purposes).

## Prerequisites

The only reason to end up this README file, is because you have run a CI pipeline which produced some attestations. 

So, the attestations are saved in a storage of your liking and the artifact likewise exists in some other storage/registry too. A client downloads the artifact and its attestations, and pass them to OPA to run verifications against some policies.